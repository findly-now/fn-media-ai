# =================================================================
# FN Media AI Service Configuration
# =================================================================

# -------------------------
# Application Settings
# -------------------------
APP_NAME="fn-media-ai"
APP_VERSION="0.1.0"
ENVIRONMENT="development"  # development, staging, production
DEBUG=true
LOG_LEVEL="INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL

# Server Configuration
HOST="0.0.0.0"
PORT=8000
WORKERS=1  # Number of uvicorn workers (production: 4-8)

# -------------------------
# Kafka Event Streaming
# -------------------------
# Confluent Cloud Kafka Configuration
KAFKA_BOOTSTRAP_SERVERS="your-kafka-cluster.confluent.cloud:9092"
KAFKA_SECURITY_PROTOCOL="SASL_SSL"
KAFKA_SASL_MECHANISM="PLAIN"
KAFKA_SASL_USERNAME="your-kafka-api-key"
KAFKA_SASL_PASSWORD="your-kafka-api-secret"

# Topic Configuration
KAFKA_CONSUMER_GROUP_ID="fn-media-ai-consumers"
KAFKA_CONSUMER_TOPICS="posts.events"  # Consumes PostCreated events
KAFKA_POST_ENHANCED_TOPIC="media-ai.enrichment"  # Publishes PostEnhanced events

# Consumer Settings
KAFKA_AUTO_OFFSET_RESET="latest"  # latest, earliest
KAFKA_MAX_POLL_RECORDS=100
KAFKA_SESSION_TIMEOUT_MS=30000
KAFKA_HEARTBEAT_INTERVAL_MS=10000

# -------------------------
# Google Cloud Storage
# -------------------------
# Photo Storage Access
GCS_BUCKET_NAME="findly-now-photos-prod"
GCS_PROJECT_ID="findly-now-production"

# Authentication (choose one method)
# Method 1: Service Account Key File
GOOGLE_APPLICATION_CREDENTIALS="/path/to/service-account-key.json"

# Method 2: Service Account Key JSON (for containers)
GOOGLE_SERVICE_ACCOUNT_JSON='{"type": "service_account", "project_id": "...", "private_key_id": "...", "private_key": "...", "client_email": "...", "client_id": "...", "auth_uri": "...", "token_uri": "...", "auth_provider_x509_cert_url": "...", "client_x509_cert_url": "..."}'

# GCS Configuration
GCS_TIMEOUT_SECONDS=60
GCS_RETRY_ATTEMPTS=3
GCS_CHUNK_SIZE=1048576  # 1MB chunks

# -------------------------
# OpenAI API Configuration
# -------------------------
OPENAI_API_KEY="sk-your-openai-api-key-here"
OPENAI_ORGANIZATION_ID="org-your-organization-id"  # Optional
OPENAI_MODEL="gpt-4o"  # gpt-4o, gpt-4-turbo, gpt-4-vision-preview
OPENAI_MAX_TOKENS=1000
OPENAI_TEMPERATURE=0.1  # Low temperature for consistent results
OPENAI_TIMEOUT_SECONDS=30
OPENAI_MAX_RETRIES=3

# Vision API Settings
OPENAI_VISION_MAX_TOKENS=1000
OPENAI_VISION_DETAIL="auto"  # auto, low, high

# -------------------------
# Redis Configuration
# -------------------------
# Caching for AI results and model weights
REDIS_URL="redis://localhost:6379/0"
REDIS_PASSWORD=""  # Leave empty for no auth
REDIS_MAX_CONNECTIONS=10
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5

# Cache Configuration
REDIS_DEFAULT_TTL=3600  # 1 hour default TTL
REDIS_AI_RESULTS_TTL=86400  # 24 hours for AI analysis results
REDIS_MODEL_CACHE_TTL=604800  # 7 days for model weights

# -------------------------
# AI/ML Model Configuration
# -------------------------

# Model Storage
MODELS_LOCAL_PATH="./models/local"
MODELS_CACHE_PATH="./models/cache"
MODELS_MAX_CACHE_SIZE="10GB"

# Hugging Face Configuration
HF_HOME="./models/cache/huggingface"
HF_TOKEN=""  # Optional: for private models
HF_HUB_CACHE="./models/cache/huggingface/hub"

# Object Detection (YOLO)
YOLO_MODEL="yolov8n.pt"  # yolov8n.pt, yolov8s.pt, yolov8m.pt, yolov8l.pt, yolov8x.pt
YOLO_CONFIDENCE_THRESHOLD=0.25
YOLO_IOU_THRESHOLD=0.45
YOLO_MAX_DETECTIONS=100
YOLO_DEVICE="cpu"  # cpu, cuda, mps (for Apple Silicon)

# Scene Classification
SCENE_MODEL="microsoft/resnet-50"
SCENE_CONFIDENCE_THRESHOLD=0.70

# OCR Configuration
OCR_ENGINE="tesseract"  # tesseract, easyocr, both
TESSERACT_CONFIG="--oem 3 --psm 6"
TESSERACT_LANG="eng"
EASYOCR_LANGUAGES=["en"]
OCR_CONFIDENCE_THRESHOLD=0.60

# Processing Configuration
AI_PROCESSING_TIMEOUT=30  # seconds
AI_MAX_CONCURRENT_REQUESTS=10
AI_BATCH_SIZE=4  # Process multiple images in batch
AI_ENABLE_GPU=false  # Enable GPU acceleration if available

# -------------------------
# Confidence Thresholds
# -------------------------
# Confidence thresholds for different AI enhancement levels
CONFIDENCE_AUTO_ENHANCE=0.85  # Automatically enhance post
CONFIDENCE_SUGGEST_TAGS=0.70  # Suggest tags to user
CONFIDENCE_HUMAN_REVIEW=0.50  # Flag for manual review
CONFIDENCE_DISCARD=0.30       # Discard low-confidence results

# -------------------------
# Performance Settings
# -------------------------
# Image Processing
MAX_IMAGE_SIZE=10485760  # 10MB max upload size
MAX_IMAGES_PER_REQUEST=5
SUPPORTED_IMAGE_FORMATS=["JPEG", "PNG", "WEBP", "BMP"]
IMAGE_QUALITY=85  # JPEG quality for processed images

# Request Limits
API_RATE_LIMIT_REQUESTS=1000  # requests per hour
API_RATE_LIMIT_BURST=50       # burst requests

# -------------------------
# Database Configuration
# -------------------------
# PostgreSQL for storing AI analysis results (optional)
DATABASE_URL="postgresql://user:password@localhost:5432/fn_media_ai"
DATABASE_POOL_SIZE=5
DATABASE_MAX_OVERFLOW=10
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_RECYCLE=3600

# -------------------------
# Monitoring & Observability
# -------------------------
# Prometheus Metrics
METRICS_ENABLED=true
METRICS_PORT=9090
METRICS_PATH="/metrics"

# Health Check Configuration
HEALTH_CHECK_TIMEOUT=30
HEALTH_CHECK_INTERVAL=60

# Logging Configuration
LOG_FORMAT="json"  # json, text
LOG_CORRELATION_ID_HEADER="X-Correlation-ID"
LOG_FILE_PATH=""  # Leave empty for stdout only

# Sentry Error Tracking (optional)
SENTRY_DSN=""
SENTRY_ENVIRONMENT="development"
SENTRY_TRACES_SAMPLE_RATE=0.1

# -------------------------
# Security Settings
# -------------------------
# API Authentication
API_KEY_HEADER="X-API-Key"
API_KEYS="your-api-key-1,your-api-key-2"  # Comma-separated list

# CORS Configuration
CORS_ALLOW_ORIGINS="*"  # In production: specific domains only
CORS_ALLOW_METHODS="GET,POST,PUT,DELETE,OPTIONS"
CORS_ALLOW_HEADERS="*"
CORS_ALLOW_CREDENTIALS=false

# Request Validation
MAX_REQUEST_SIZE=52428800  # 50MB max request size
REQUEST_TIMEOUT=300        # 5 minutes max request timeout

# -------------------------
# Feature Flags
# -------------------------
# Enable/disable specific AI models
ENABLE_OBJECT_DETECTION=true
ENABLE_SCENE_CLASSIFICATION=true
ENABLE_OCR_EXTRACTION=true
ENABLE_LOCATION_INFERENCE=true
ENABLE_SMART_DESCRIPTION=true

# Processing Features
ENABLE_BATCH_PROCESSING=true
ENABLE_RESULT_CACHING=true
ENABLE_MODEL_CACHING=true
ENABLE_ASYNC_PROCESSING=true

# -------------------------
# Development Settings
# -------------------------
# Development-only settings
DEV_MOCK_AI_RESPONSES=false  # Use mock responses for faster testing
DEV_SAVE_PROCESSED_IMAGES=false  # Save processed images locally
DEV_ENABLE_DEBUG_ENDPOINTS=true  # Enable debug API endpoints
DEV_BYPASS_AUTH=false  # Bypass API authentication in development

# Testing Configuration
TEST_DATA_PATH="./tests/data"
TEST_MOCK_EXTERNAL_APIS=true
TEST_TIMEOUT=60

# -------------------------
# Deployment Settings
# -------------------------
# Container/Kubernetes specific
CONTAINER_NAME="fn-media-ai"
KUBERNETES_NAMESPACE="findly-now"
KUBERNETES_SERVICE_NAME="fn-media-ai-service"

# Resource Limits
MEMORY_LIMIT="2Gi"
CPU_LIMIT="1000m"
GPU_MEMORY_LIMIT="4Gi"  # If GPU enabled

# Graceful Shutdown
SHUTDOWN_TIMEOUT=30  # seconds to wait for graceful shutdown

# -------------------------
# Backup Configuration
# -------------------------
# Backup processed results (optional)
BACKUP_ENABLED=false
BACKUP_BUCKET="findly-now-ai-backups"
BACKUP_RETENTION_DAYS=30